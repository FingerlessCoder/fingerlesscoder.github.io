---
import Layout from '../layouts/Layout.astro';
import projects from '../data/projects.json';

interface Project {
  name: string;
  description: string;
  github?: string;
  tags: string[];
  category: string;
  image: string;
  featured: boolean;
  story: string;
}

const allProjects = projects as Project[];
const categories = ['all', 'web', 'tooling', 'library', 'game'];
const categoryLabels: Record<string, string> = {
  all: 'All',
  web: 'Web',
  tooling: 'Tooling',
  library: 'Library',
  game: 'Game',
};

const stats = {
  total: allProjects.length,
  web: allProjects.filter((p) => p.category === 'web').length,
  tooling: allProjects.filter((p) => p.category === 'tooling').length,
  library: allProjects.filter((p) => p.category === 'library').length,
  game: allProjects.filter((p) => p.category === 'game').length,
  featured: allProjects.filter((p) => p.featured).length,
};
---

<Layout
  title="Projects"
  description="Explore portfolio projects by Fingerless Coder, including web apps, tools, libraries, and interactive builds."
  currentPage="/projects"
>
  <section class="relative min-h-[60vh] flex items-center overflow-hidden">
    <div class="absolute inset-0">
      <picture>
        <source media="(min-width: 768px)" srcset="/wallpaper.png" />
        <img src="/portfolio.png" alt="Portfolio Background" class="w-full h-full object-cover object-bottom scale-105 animate-float" decoding="async" fetchpriority="high" width="1920" height="1080" />
      </picture>
      <div class="absolute inset-0 bg-gradient-to-r from-charcoal-950/90 via-charcoal-900/85 to-charcoal-950/90"></div>
      <div class="absolute inset-0 bg-gradient-to-t from-charcoal-950 via-transparent to-transparent"></div>
    </div>

    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-teal-400/10 rounded-full blur-3xl animate-blob glow-teal"></div>
      <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-coral-400/8 rounded-full blur-3xl animate-blob animation-delay-2000 glow-coral"></div>
      <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-indigo-400/10 rounded-full blur-3xl animate-blob animation-delay-4000 glow-indigo"></div>
    </div>

    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
      <div class="text-center">
        <h1 class="text-5xl sm:text-6xl lg:text-7xl font-bold tracking-tight mb-6">
          <span class="bg-gradient-to-r from-teal-400 via-indigo-400 to-coral-400 bg-clip-text text-transparent animate-gradient-shift">
            Projects
          </span>
        </h1>
        <p class="text-xl sm:text-2xl text-slate-300 max-w-4xl mx-auto leading-relaxed mb-8">
          A collection of things I have built. Some for coursework, some for fun, all for learning.
        </p>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 max-w-2xl mx-auto mt-12">
          <div class="glass rounded-xl p-4 border border-indigo-400/20 hover:border-teal-400/40 transition-all duration-300 hover:scale-105 hover:glow-teal">
            <div class="text-2xl font-bold text-teal-400">{stats.total}</div>
            <div class="text-sm text-slate-400">Total</div>
          </div>
          <div class="glass rounded-xl p-4 border border-indigo-400/20 hover:border-indigo-400/40 transition-all duration-300 hover:scale-105 hover:glow-indigo">
            <div class="text-2xl font-bold text-indigo-400">{stats.web}</div>
            <div class="text-sm text-slate-400">Web</div>
          </div>
          <div class="glass rounded-xl p-4 border border-indigo-400/20 hover:border-coral-400/40 transition-all duration-300 hover:scale-105 hover:glow-coral">
            <div class="text-2xl font-bold text-coral-400">{stats.tooling}</div>
            <div class="text-sm text-slate-400">Tools</div>
          </div>
          <div class="glass rounded-xl p-4 border border-indigo-400/20 hover:border-teal-400/40 transition-all duration-300 hover:scale-105 hover:glow-teal">
            <div class="text-2xl font-bold text-teal-400">{stats.featured}</div>
            <div class="text-sm text-slate-400">Featured</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16" aria-labelledby="projects-title">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-wrap justify-center gap-3 mb-12">
        {categories.map((category) => (
          <button
            class={`filter-btn ${category === 'all' ? 'active' : ''}`}
            data-category={category}
          >
            {categoryLabels[category]}
          </button>
        ))}
      </div>

      <div id="projects-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8">
        {allProjects.map((project) => (
          <article class="card group" data-category={project.category}>
            <div class="relative mb-4 overflow-hidden rounded-lg bg-gradient-to-br from-brand-800 to-brand-900 p-1 aspect-video">
              <img src={project.image} alt={project.name}
                class="absolute inset-0 w-full h-full object-cover"
                decoding="async"
                loading="lazy"
                width="1280"
                height="720" />
              {project.featured && (
                <div class="absolute top-3 right-3">
                  <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-accent-500/20 text-accent-300 border border-accent-400/30 animate-pulse">
                    Featured
                  </span>
                </div>
              )}
            </div>
            <div class="flex items-start justify-between gap-2 mb-2">
              <h3 class="flex-1 flex items-center flex-wrap">
                <span class="text-brand-100 font-semibold text-lg">{project.name}</span>
              </h3>
            </div>
            <p class="text-slate-300 text-sm leading-relaxed mb-4">{project.description}</p>
            <div class="flex flex-wrap gap-2 mt-auto">
              {project.tags.map((tag) => (
                <span class="tag">{tag}</span>
              ))}
            </div>

            {project.story && (
              <details class="mt-4 pt-4 border-t border-brand-800 group-open:animate-fade-in">
                <summary class="cursor-pointer text-sm text-accent-400 hover:text-accent-300 transition-colors select-none list-none">
                  <span class="flex items-center gap-2">
                    Story
                  </span>
                </summary>
                <p class="text-slate-400 text-sm mt-3 leading-relaxed italic">{project.story}</p>
              </details>
            )}

            {project.github && (
              <div class="flex gap-3 mt-4 pt-4 border-t border-brand-800">
                <a href={project.github} target="_blank" rel="noopener noreferrer"
                  class="inline-flex items-center gap-2 text-sm text-accent-400 hover:text-accent-300 transition-colors">
                  View Code
                </a>
              </div>
            )}
          </article>
        ))}
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const filterBtns = document.querySelectorAll('.filter-btn');
      const projects = document.querySelectorAll('#projects-grid article');

      filterBtns.forEach((btn) => {
        btn.addEventListener('click', () => {
          const category = (btn as HTMLElement).dataset.category;

          filterBtns.forEach((b) => b.classList.remove('active'));
          btn.classList.add('active');

          projects.forEach((project) => {
            const projectCategory = (project as HTMLElement).dataset.category;
            if (category === 'all' || projectCategory === category) {
              (project as HTMLElement).style.display = '';
              (project as HTMLElement).classList.add('animate-fade-in');
            } else {
              (project as HTMLElement).style.display = 'none';
            }
          });
        });
      });
    });
  </script>
</Layout>
